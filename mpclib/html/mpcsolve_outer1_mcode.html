<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T1U3">z</span>,<span class="var type1" id="S3T24U4">info</span>] = mpcsolve_outer(<span class="var type1" id="S4T3U7">x</span>,<span class="var type1" id="S5T3U8">xt</span>,<span class="var type1" id="S6T3U9">d</span>,<span class="var type2" id="S7T16V1U10">H</span>,<span class="var type2" id="S8T1V2U11">g</span>,<span class="var type2" id="S9T2V3U12">gt</span>,<span class="var type2" id="S10T17V4U13">P</span>,<span class="var type2" id="S11T12V5U14">hc</span>,<span class="var type2" id="S12T13V6U15">hx</span>,<span class="var type2" id="S13T18V7U16">C</span>,<span class="var type2" id="S14T14V8U17">bx</span>,<span class="var type2" id="S15T14V9U18">bd</span>,<span class="var type1" id="S16T1U19">z0</span>,<span class="var type2" id="S17T19V10U20">A</span>,<span class="var type2" id="S18T3V11U21">B</span>,<span class="var type2" id="S19T20V12U22">Fx</span>,<span class="var type2" id="S20T21V13U23">Fu</span>,<span class="var type2" id="S21T22V14U24">Ff</span>,<span class="var type2" id="S22T19V15U25">Q</span>,<span class="var type2" id="S23T7V16U26">R</span>,<span class="var type2" id="S24T19V15U27">Qf</span>,<span class="var type2" id="S25T23V17U28">opts</span>,<span class="var type2" id="S26T16V18U29">Ps</span>,<span class="var type2" id="S27T1V19U30">hcs</span>,<span class="var type2" id="S28T2V20U31">hxs</span>,<span class="var type2" id="S29T20V21U32">Ef</span>,<span class="var type2" id="S30T22V22U33">Fxs</span>,<span class="var type2" id="S31T24V23U34">Fus</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,2" id="srcline2"> 2</a></span><span class="line"><span class="comment">%#codegen</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,3" id="srcline3"> 3</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,4" id="srcline4"> 4</a></span><span class="line"><span class="comment">% this version just takes all constant matrices and, separately, the</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,5" id="srcline5"> 5</a></span><span class="line"><span class="comment">% dynamic state, stage target and disturbance estimate</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,6" id="srcline6"> 6</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,7" id="srcline7"> 7</a></span><span class="line"><span class="comment">% state-dependent weights etc</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,8" id="srcline8"> 8</a></span><span class="line"><span class="mxinfo " id="T1:U31"><span class="var type1" id="S32T1U37">g1</span> = <span class="mxinfo " id="T1:U33"><span class="mxinfo " id="T1:U34"><span class="var type1" id="S8T1U39">g</span></span> + <span class="mxinfo " id="T1:U36"><span class="mxinfo " id="T2:U37"><span class="var type1" id="S9T2U41">gt</span></span>*<span class="var type1" id="S5T3U42">xt</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,9" id="srcline9"> 9</a></span><span class="line"><span class="mxinfo " id="T12:U40"><span class="var type1" id="S33T12U45">h1</span> = <span class="mxinfo " id="T12:U42"><span class="mxinfo " id="T12:U43"><span class="var type1" id="S11T12U47">hc</span></span> + <span class="mxinfo " id="T12:U45"><span class="mxinfo " id="T13:U46"><span class="var type1" id="S12T13U49">hx</span></span>*<span class="var type1" id="S4T3U50">x</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,10" id="srcline10">10</a></span><span class="line"><span class="mxinfo " id="T15:U49"><span class="var type1" id="S34T15U53">b1</span> = <span class="mxinfo " id="T15:U51"><span class="mxinfo " id="T15:U52"><span class="mxinfo " id="T14:U53"><span class="var type1" id="S14T14U56">bx</span></span>*<span class="var type1" id="S4T3U57">x</span></span> + <span class="mxinfo " id="T15:U56"><span class="mxinfo " id="T14:U57"><span class="var type1" id="S15T14U59">bd</span></span>*<span class="var type1" id="S6T3U60">d</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,11" id="srcline11">11</a></span><span class="line"><span class="mxinfo " id="T1:U60"><span class="var type1" id="S35T1U63">hs1</span> = <span class="mxinfo " id="T1:U62"><span class="mxinfo " id="T1:U63"><span class="mxinfo " id="T2:U64"><span class="var type1" id="S28T2U66">hxs</span></span>*<span class="var type1" id="S4T3U67">x</span></span> + <span class="mxinfo " id="T1:U67"><span class="var type1" id="S27T1U68">hcs</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,12" id="srcline12">12</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,13" id="srcline13">13</a></span><span class="line"><span class="comment">% solve it</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,14" id="srcline14">14</a></span><span class="line">[<span class="mxinfo " id="T1:U69"><span class="var type1" id="S2T1U72">z</span></span>,<span class="mxinfo " id="T24:U71"><span class="var type1" id="S3T24U73">info</span></span>] = <span class="fcn" id="F1245N2:B75">mpcsolve</span>(<span class="mxinfo " id="T16:U73"><span class="var type1" id="S7T16U76">H</span></span>,<span class="var type1" id="S32T1U77">g1</span>,<span class="mxinfo " id="T17:U76"><span class="var type1" id="S10T17U78">P</span></span>,<span class="var type1" id="S33T12U79">h1</span>,<span class="mxinfo " id="T18:U79"><span class="var type1" id="S13T18U80">C</span></span>,<span class="var type1" id="S34T15U81">b1</span>,<span class="var type1" id="S16T1U82">z0</span>,<span class="mxinfo " id="T19:U83"><span class="var type1" id="S17T19U83">A</span></span>,<span class="mxinfo " id="T3:U85"><span class="var type1" id="S18T3U84">B</span></span>,<span class="mxinfo " id="T20:U87"><span class="var type1" id="S19T20U85">Fx</span></span>,<span class="mxinfo " id="T21:U89"><span class="var type1" id="S20T21U86">Fu</span></span>,<span class="mxinfo " id="T22:U91"><span class="var type1" id="S21T22U87">Ff</span></span>,<span class="mxinfo " id="T19:U93"><span class="var type1" id="S22T19U88">Q</span></span>,<span class="mxinfo " id="T7:U95"><span class="var type1" id="S23T7U89">R</span></span>,<span class="mxinfo " id="T19:U97"><span class="var type1" id="S24T19U90">Qf</span></span>,<span class="mxinfo " id="T23:U99"><span class="var type1" id="S25T23U91">opts</span></span>,<span class="mxinfo " id="T16:U101"><span class="var type1" id="S26T16U92">Ps</span></span>,<span class="var type1" id="S35T1U93">hs1</span>,<span class="mxinfo " id="T20:U104"><span class="var type1" id="S29T20U94">Ef</span></span>,<span class="mxinfo " id="T22:U106"><span class="var type1" id="S30T22U95">Fxs</span></span>,<span class="mxinfo " id="T24:U108"><span class="var type1" id="S31T24U96">Fus</span></span>);</span></span>
</pre>
